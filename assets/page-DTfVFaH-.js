import{c as W,u as B,d as G,r as o,s as g,j as e}from"./index-DLj1qXuc.js";function H(){const{user:i,signOut:I}=W(),{darkMode:t}=B(),u=G(),[m,P]=o.useState("profile"),[x,k]=o.useState(null),[$,E]=o.useState([]),[N,C]=o.useState([]),[A,_]=o.useState(!0),[h,y]=o.useState(!1),[p,l]=o.useState(null),[a,c]=o.useState({full_name:"",phone:"",address:"",city:"",country:"",postal_code:"",bio:""}),[s,b]=o.useState({current:"",new:"",confirm:""}),[j,D]=o.useState(null),[V,q]=o.useState(null);o.useEffect(()=>{if(!i){u("/login");return}S()},[i,u]);const S=async()=>{try{_(!0);const{data:r,error:n}=await g.from("profiles").select("*").eq("id",i.id).single();if(n)throw n;k(r),c({full_name:r.full_name||"",phone:r.phone||"",address:r.address||"",city:r.city||"",country:r.country||"",postal_code:r.postal_code||"",bio:r.bio||""});const{data:d,error:v}=await g.from("orders").select(`
          id,
          order_number,
          total,
          status,
          created_at,
          order_items (
            id,
            quantity,
            price,
            product_id
          )
        `).eq("user_id",i.id).order("created_at",{ascending:!1}).limit(10);!v&&d&&E(d);const{data:w,error:R}=await g.from("wishlist").select(`
          id,
          products (
            id,
            name,
            price,
            images
          )
        `).eq("user_id",i.id);!R&&w&&C(w.map(f=>({id:f.id,product:{id:f.products.id,name:f.products.name,price:f.products.price,image_url:f.products.images?.[0]||""}})))}catch(r){console.error("Erro ao carregar dados:",r),l({type:"error",text:"Erro ao carregar dados do perfil"})}finally{_(!1)}},F=async()=>{if(!j||!i)return null;try{const r=j.name.split(".").pop(),d=`avatars/${`${i.id}-${Date.now()}.${r}`}`,{error:v}=await g.storage.from("public").upload(d,j);if(v)throw v;const{data:w}=g.storage.from("public").getPublicUrl(d);return w.publicUrl}catch(r){return console.error("Erro ao fazer upload da imagem:",r),null}},L=async()=>{try{y(!0),l(null);let r=x?.avatar_url;if(j){const d=await F();d&&(r=d)}const{error:n}=await g.from("profiles").update({...a,avatar_url:r,updated_at:new Date().toISOString()}).eq("id",i.id);if(n)throw n;l({type:"success",text:"Perfil atualizado com sucesso!"}),D(null),q(null),await S()}catch(r){console.error("Erro ao salvar perfil:",r),l({type:"error",text:"Erro ao salvar perfil"})}finally{y(!1)}},U=async()=>{try{if(s.new!==s.confirm){l({type:"error",text:"As senhas não coincidem"});return}if(s.new.length<6){l({type:"error",text:"A senha deve ter no mínimo 6 caracteres"});return}y(!0),l(null);const{error:r}=await g.auth.updateUser({password:s.new});if(r)throw r;l({type:"success",text:"Senha alterada com sucesso!"}),b({current:"",new:"",confirm:""})}catch(r){console.error("Erro ao alterar senha:",r),l({type:"error",text:r.message||"Erro ao alterar senha"})}finally{y(!1)}},z=async r=>{try{const{error:n}=await g.from("wishlist").delete().eq("id",r);if(n)throw n;C(N.filter(d=>d.id!==r)),l({type:"success",text:"Produto removido da lista de desejos"})}catch(n){console.error("Erro ao remover produto:",n),l({type:"error",text:"Erro ao remover produto"})}},M=r=>{switch(r){case"admin":return"Administrador";case"customer":return"Cliente";default:return"Utilizador"}},T=r=>{switch(r){case"completed":return"bg-green-500";case"processing":return"bg-blue-500";case"pending":return"bg-yellow-500";case"cancelled":return"bg-red-500";default:return"bg-gray-500"}},O=r=>{switch(r){case"completed":return"Concluído";case"processing":return"Em Processamento";case"pending":return"Pendente";case"cancelled":return"Cancelado";default:return r}};return A?e.jsx("div",{className:`min-h-screen ${t?"bg-[#0b0011]":"bg-gray-50"} flex items-center justify-center`,children:e.jsx("div",{className:"w-16 h-16 border-4 border-[#b62bff] border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:`min-h-screen ${t?"bg-[#0b0011]":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:`rounded-xl p-8 mb-8 ${t?"bg-surface border border-gray-800":"bg-white border border-gray-200"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-[#b62bff] to-[#ff6a00] flex items-center justify-center text-white text-4xl font-bold",children:x?.avatar_url?e.jsx("img",{src:x.avatar_url,alt:"Avatar",className:"w-full h-full rounded-full object-cover"}):x?.full_name?.charAt(0)||i?.email?.charAt(0)||"?"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:`text-3xl font-bold mb-2 ${t?"text-white":"text-gray-900"}`,children:x?.full_name||"Sem nome"}),e.jsx("p",{className:`text-lg mb-3 ${t?"text-gray-400":"text-gray-600"}`,children:i?.email}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 justify-center md:justify-start",children:[e.jsx("span",{className:"px-4 py-2 bg-gradient-to-r from-[#b62bff] to-[#ff6a00] text-white text-sm font-medium rounded-full",children:M(x?.role||"customer")}),e.jsxs("span",{className:`px-4 py-2 ${t?"bg-gray-800 text-gray-300":"bg-gray-100 text-gray-700"} text-sm font-medium rounded-full`,children:["Membro desde ",new Date(x?.created_at||Date.now()).getFullYear()]})]})]})]})}),p&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${p.type==="success"?"bg-green-500/20 border border-green-500/50":"bg-red-500/20 border border-red-500/50"}`,children:e.jsx("p",{className:p.type==="success"?"text-green-500":"text-red-500",children:p.text})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:[{id:"profile",icon:"ri-user-settings-line",label:"Perfil"},{id:"orders",icon:"ri-file-list-line",label:"Pedidos"},{id:"wishlist",icon:"ri-heart-line",label:"Lista de Desejos"},{id:"security",icon:"ri-shield-check-line",label:"Segurança"}].map(r=>e.jsxs("button",{onClick:()=>P(r.id),className:`px-6 py-3 rounded-lg font-medium transition-all ${m===r.id?"bg-gradient-to-r from-[#b62bff] to-[#ff6a00] text-white shadow-lg":t?"bg-gray-900 text-gray-300 hover:bg-gray-800":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("i",{className:`${r.icon} mr-2`}),r.label]},r.id))}),e.jsxs("div",{className:`${t?"bg-gray-900":"bg-white"} rounded-2xl shadow-xl p-8`,children:[m==="profile"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"} mb-6`,children:"Informações Pessoais"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Nome Completo"}),e.jsx("input",{type:"text",value:a.full_name,onChange:r=>c({...a,full_name:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Telefone"}),e.jsx("input",{type:"tel",value:a.phone,onChange:r=>c({...a,phone:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Morada"}),e.jsx("input",{type:"text",value:a.address,onChange:r=>c({...a,address:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Cidade"}),e.jsx("input",{type:"text",value:a.city,onChange:r=>c({...a,city:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"País"}),e.jsx("input",{type:"text",value:a.country,onChange:r=>c({...a,country:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Código Postal"}),e.jsx("input",{type:"text",value:a.postal_code,onChange:r=>c({...a,postal_code:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Bio"}),e.jsx("textarea",{value:a.bio,onChange:r=>c({...a,bio:r.target.value}),rows:4,className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors resize-none`})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-gray-700",children:[e.jsx("button",{onClick:()=>u(-1),className:`px-6 py-3 rounded-lg font-medium ${t?"bg-gray-800 text-white hover:bg-gray-700":"bg-gray-100 text-gray-900 hover:bg-gray-200"} transition-colors`,children:"Cancelar"}),e.jsx("button",{onClick:L,disabled:h,className:"px-6 py-3 bg-gradient-to-r from-[#b62bff] to-[#ff6a00] text-white font-medium rounded-lg hover:shadow-lg transition-all disabled:opacity-50",children:h?"A guardar...":"Guardar Alterações"})]})]}),m==="orders"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"} mb-6`,children:"Meus Pedidos"}),$.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-file-list-line text-6xl text-gray-500 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Ainda não tem pedidos"}),e.jsx("button",{onClick:()=>u("/category"),className:"mt-6 px-6 py-3 bg-gradient-to-r from-[#b62bff] to-[#ff6a00] text-white font-medium rounded-lg hover:shadow-lg transition-all",children:"Começar a Comprar"})]}):e.jsx("div",{className:"space-y-4",children:$.map(r=>e.jsxs("div",{className:`p-6 rounded-lg border ${t?"bg-gray-800 border-gray-700":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`text-lg font-bold ${t?"text-white":"text-gray-900"}`,children:["Pedido #",r.order_number]}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(r.created_at).toLocaleDateString("pt-PT",{day:"2-digit",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-4 py-2 ${T(r.status)} text-white text-sm font-medium rounded-lg`,children:O(r.status)}),e.jsxs("span",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"}`,children:["€",r.total.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("i",{className:"ri-shopping-bag-line"}),e.jsxs("span",{children:[r.items?.length||0," ",r.items?.length===1?"item":"itens"]})]})]},r.id))})]}),m==="wishlist"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"} mb-6`,children:"Lista de Desejos"}),N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-heart-line text-6xl text-gray-500 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Sua lista de desejos está vazia"}),e.jsx("button",{onClick:()=>u("/category"),className:"mt-6 px-6 py-3 bg-gradient-to-r from-[#b62bff] to-[#ff6a00] text-white font-medium rounded-lg hover:shadow-lg transition-all",children:"Explorar Produtos"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(r=>e.jsxs("div",{className:`rounded-lg border ${t?"bg-gray-800 border-gray-700":"bg-gray-50 border-gray-200"} overflow-hidden`,children:[e.jsx("div",{className:"aspect-square bg-gray-700 overflow-hidden",children:e.jsx("img",{src:r.product.image_url||"https://via.placeholder.com/400",alt:r.product.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:`font-bold mb-2 ${t?"text-white":"text-gray-900"}`,children:r.product.name}),e.jsxs("p",{className:"text-2xl font-bold text-[#b62bff] mb-4",children:["€",r.product.price.toFixed(2)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(`/product/${r.product.id}`),className:"flex-1 px-4 py-2 bg-gradient-to-r from-[#b62bff] to-[#ff6a00] text-white font-medium rounded-lg hover:shadow-lg transition-all",children:"Ver Produto"}),e.jsx("button",{onClick:()=>z(r.id),className:`px-4 py-2 rounded-lg ${t?"bg-gray-700 hover:bg-red-900/20 text-red-400":"bg-gray-200 hover:bg-red-50 text-red-600"} transition-colors`,children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]})]},r.id))})]}),m==="security"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"} mb-6`,children:"Segurança"}),e.jsxs("div",{className:"max-w-2xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Senha Atual"}),e.jsx("input",{type:"password",value:s.current,onChange:r=>b({...s,current:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Nova Senha"}),e.jsx("input",{type:"password",value:s.new,onChange:r=>b({...s,new:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Confirmar Nova Senha"}),e.jsx("input",{type:"password",value:s.confirm,onChange:r=>b({...s,confirm:r.target.value}),className:`w-full px-4 py-3 rounded-lg ${t?"bg-gray-800 text-white border-gray-700":"bg-gray-50 text-gray-900 border-gray-200"} border focus:border-[#b62bff] focus:outline-none transition-colors`})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-gray-700",children:[e.jsx("button",{onClick:()=>b({current:"",new:"",confirm:""}),className:`px-6 py-3 rounded-lg font-medium ${t?"bg-gray-800 text-white hover:bg-gray-700":"bg-gray-100 text-gray-900 hover:bg-gray-200"} transition-colors`,children:"Cancelar"}),e.jsx("button",{onClick:U,disabled:h||!s.new||!s.confirm,className:"px-6 py-3 bg-gradient-to-r from-[#b62bff] to-[#ff6a00] text-white font-medium rounded-lg hover:shadow-lg transition-all disabled:opacity-50",children:h?"A alterar...":"Alterar Senha"})]})]})]})]})]})})}export{H as default};
//# sourceMappingURL=page-DTfVFaH-.js.map
