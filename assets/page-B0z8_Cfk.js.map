{"version":3,"file":"page-B0z8_Cfk.js","sources":["../../src/pages/login/page.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { useTheme } from '../../contexts/ThemeContext';\r\n\r\nexport default function LoginPage() {\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const { signIn, user } = useAuth();\r\n  const { darkMode } = useTheme();\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    // Se já estiver logado, redirecionar baseado no role\r\n    const checkUserAndRedirect = async () => {\r\n      if (user) {\r\n        try {\r\n          const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .maybeSingle();\r\n\r\n          if (profile) {\r\n            const adminRoles = ['superadmin', 'admin', 'manager', 'editor', 'financial', 'support'];\r\n            if (adminRoles.includes(profile.role)) {\r\n              navigate('/admin/dashboard');\r\n            } else {\r\n              navigate('/');\r\n            }\r\n          } else {\r\n            // Se não tem perfil, é cliente normal\r\n            navigate('/');\r\n          }\r\n        } catch (error) {\r\n          console.error('Erro ao verificar perfil:', error);\r\n          navigate('/');\r\n        }\r\n      }\r\n    };\r\n\r\n    checkUserAndRedirect();\r\n  }, [user, navigate]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n\r\n    try {\r\n      await signIn(email, password);\r\n      \r\n      // Verificar role do utilizador\r\n      const { data: { user: currentUser } } = await supabase.auth.getUser();\r\n      \r\n      if (currentUser) {\r\n        const { data: profile } = await supabase\r\n          .from('profiles')\r\n          .select('role')\r\n          .eq('id', currentUser.id)\r\n          .maybeSingle();\r\n\r\n        if (profile) {\r\n          const adminRoles = ['superadmin', 'admin', 'manager', 'editor', 'financial', 'support'];\r\n          if (adminRoles.includes(profile.role)) {\r\n            // É admin - vai para dashboard\r\n            navigate('/admin/dashboard');\r\n          } else {\r\n            // É cliente - vai para o site\r\n            navigate('/');\r\n          }\r\n        } else {\r\n          // Sem perfil = cliente normal\r\n          navigate('/');\r\n        }\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || 'Erro ao fazer login. Verifique as suas credenciais.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`min-h-screen flex items-center justify-center ${darkMode ? 'bg-[#0b0011]' : 'bg-gray-50'} px-4`}>\r\n      <div className=\"max-w-md w-full\">\r\n        {/* Logo */}\r\n        <Link to=\"/\" className=\"flex items-center justify-center gap-2 mb-8\">\r\n          <div className=\"w-12 h-12 bg-gradient-to-br from-[#b62bff] to-[#ff6a00] rounded-lg flex items-center justify-center\">\r\n            <i className=\"ri-store-3-line text-white text-2xl\"></i>\r\n          </div>\r\n          <span className=\"text-2xl font-bold bg-gradient-to-r from-[#b62bff] to-[#ff6a00] bg-clip-text text-transparent\">\r\n            JokaTech\r\n          </span>\r\n        </Link>\r\n\r\n        {/* Formulário */}\r\n        <div className={`${darkMode ? 'bg-[#170018] border-gray-800' : 'bg-white border-gray-200'} rounded-2xl shadow-xl border p-8`}>\r\n          <h1 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'} mb-2 text-center`}>\r\n            Entrar na sua conta\r\n          </h1>\r\n          <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-6 text-center`}>\r\n            Aceda à sua conta para continuar\r\n          </p>\r\n\r\n          {error && (\r\n            <div className=\"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-800 rounded-lg\">\r\n              <p className=\"text-sm text-red-700 dark:text-red-400\">{error}</p>\r\n            </div>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div>\r\n              <label className={`block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>\r\n                E-mail\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                required\r\n                className={`w-full px-4 py-3 ${\r\n                  darkMode ? 'bg-[#0b0011] border-gray-700 text-white' : 'bg-gray-50 border-gray-300 text-gray-900'\r\n                } border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#b62bff]`}\r\n                placeholder=\"seu@email.com\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className={`block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>\r\n                Senha\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                required\r\n                className={`w-full px-4 py-3 ${\r\n                  darkMode ? 'bg-[#0b0011] border-gray-700 text-white' : 'bg-gray-50 border-gray-300 text-gray-900'\r\n                } border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#b62bff]`}\r\n                placeholder=\"••••••••\"\r\n              />\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"w-full px-4 py-3 bg-gradient-to-r from-[#b62bff] to-[#ff6a00] hover:opacity-90 disabled:opacity-50 text-white font-medium rounded-lg transition-opacity whitespace-nowrap disabled:cursor-not-allowed\"\r\n            >\r\n              {loading ? 'A entrar...' : 'Entrar'}\r\n            </button>\r\n          </form>\r\n\r\n          <div className=\"mt-6 text-center\">\r\n            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n              Não tem uma conta?{' '}\r\n              <Link to=\"/register\" className=\"text-[#b62bff] hover:text-[#ff6a00] font-medium transition-colors\">\r\n                Criar conta\r\n              </Link>\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Voltar */}\r\n        <div className=\"mt-6 text-center\">\r\n          <Link to=\"/\" className={`text-sm ${darkMode ? 'text-gray-400 hover:text-[#b62bff]' : 'text-gray-600 hover:text-[#b62bff]'} transition-colors`}>\r\n            <i className=\"ri-arrow-left-line mr-1\"></i>\r\n            Voltar ao site\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["LoginPage","email","setEmail","useState","password","setPassword","loading","setLoading","error","setError","signIn","user","useAuth","darkMode","useTheme","navigate","useNavigate","useEffect","profile","supabase","handleSubmit","e","currentUser","err","jsx","jsxs","Link"],"mappings":"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"}